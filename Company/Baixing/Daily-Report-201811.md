## 2018-11-01

DONE
- 逛逛本周三个需求上线
- 内容服务分段上传接口实现，service拆分重构，任务流重构（实现了管道式任务流）

TODO
- 内容服务demo仓库迁移至正式代码仓库
  
THINKING
- 尝试实现管道式任务流（场景：对转码文件进行切片，而不是对源文件）的时候，重构了原本的任务流配置结构，采用了PREPIPE, PIPE，POSTPIPE的三段式上传策略（上传后立即触发的任务流），其中PREPIPE是对源文件进行的若干操作，即输入是源文件，输出需要持久化，可并发执行；PIPE是管道式任务流，输入是源文件，输出需要持久化，任务流中前者输出是后者输入，中间结果是否持久化待定（七牛给的管道式fop操作似乎不支持保存中间结果，也就是中间结果不支持持久化）；POSTPIPE是对管道式任务流的输出进行的若干操作，即POSTPIPE是在管道式任务流的回调处理中处理的（因为管道式任务流的输出需要在回调中获取）。设想的一个场景是，`PREPIPE：[]，PIPE：[TRANSCODE, WATERMARK, SEGMENT, PROTECT], POSTPIPE: [SCREENSHOT]`，但这里由于七牛云不支持保存中间结果，转码后的文件不能持久化，显然不可行，还得重新评估一下。


## 2018-11-05

DONE
- 逛逛本周需求：信息详情页中突出拨打电话的信息；阶段：可以送测。
- 媒体内容服务：多配置文件切割；pr合并。

TODO
- 线上数据库查询逛逛新用户手机号绑定相关数据统计，排查绑定成功率下降原因。
  
THINKING
- 逛逛上周上线绑定手机号后置之后，进入绑定页的流量下降明显，而进入绑定页之后的绑定成功率更是从30%+跌到了7%左右，后者是不可接受的，扰哥今天在逛逛需求会上提出来之后，今天花了很多时间去找原因。反复阅读代码，重新测试bug，都没有找到关键原因，这让我怀疑打点数据的可靠性——打点获取的数据真的是我们需要的数据吗，现实点看首先一点就是：埋点是否能够handle各种复杂异常情况？以手机号绑定为例，打点数据更多是用来作为绑定手机号的行为判定，而落库数据才是真正的绑定手机号的结果，以结果导向来看，我们应该更加关注结果，并且只能以结果为准。所以今天跟扰哥搞了很久没搞清楚原因，当扰哥说是不是可以增加后端打点的时候，我感觉不行，毕竟神策的统计维度有很多我还没看明白的……所以还是明天去看看可控性更高的数据库吧……
- 最近做逛逛大多都是前端需求，自己前端太菜了，所以今天开始看js了哈哈，看了阮一峰的那个教程，前面介绍了js的历史，总算是对js在2008年之后的历史有所了解，记住了一句话，“js是互联网时代的汇编”，还挺有意思的。
- 最近感觉音视频处理的任务流是个老大难，难在对具体业务不够了解的情况下，设计一个足够简单而又扩展性极强的数据结构，能够表述清楚默认需要处理的事情，并且这些事情是能够通过排列组合云服务商提供的接口完美实现的。本来七牛云提供了一个fops的"|"（串行任务流）语法和";"(并行任务流)语法，我感觉很好很强大，后来发现这个串行任务流不支持保存中间结果（尽管七牛本身已经提供了类似的语法支持），真是硬伤……


## 2018-11-06
DONE
- 逛逛本周需求：发布成功页增加“再发一条”的入口。和昨天完成开发的需求一并送测。
- 与毕涛对齐媒体内容服务必要的resource、task接口以及实现，以及消息队列的处理接口形式。

TODO
- 确认逛逛打点部分缺失的问题，并尽快修复
- 媒体内容服务除上传之外的其他API调用，开始接入回调
THINKING
- 今天信誓旦旦地跟志超说七牛上传时不支持魔法变量命名文件，然后被赤裸裸打脸，分析下来，首先七牛云的文档有一些误导性，我还真信了它的邪，根本不知道文件命令还可以在上传策略里配参数，而不仅仅是通过必填参数key；其次就是上回做hls切片，切片后的m3u8文件不支持魔法变量式命名，导致无法自动命名成带后缀的形式，这个问题我还提了工单问过，回复说不行，需要我这边手动指定，我就把这个命名问题和上传的命名问题混淆了。。。
- 大学期间做过的最大的项目和毕业设计主题都是有关任务调度系统的，对这个还是挺感兴趣的，但是实际业务中一般来说都是理想设计的残缺形态……


## 2018-11-07
DONE
- 逛逛突出显示拨打电话的需求修UI问题
- 媒体内容服务开发：音视频处理调用；resource和task的接口补充及其实现；上传默认处理任务流实现。进度：从文件上传到任务流调用，流程走通，数据库记录走通。

TODO
- 媒体内容服务部署到dev，开始测试七牛回调
  
THINKING
- 暂无
- 今天聚餐吃得挺开心

## 2018-11-08 阴
DONE
- 逛逛上线后bug修复
- 媒体内容服务：上传后默认处理任务流，模拟七牛回调验证通过，任务状态流转基本正确；实现资源查询接口，通过id查询到的结果可以直接使用（比如视频可以播放）。
  
TODO
- 媒体内容服务：mq的json序列化，dev环境真实回调验证，熟悉质量鉴黄的接口文档

THINKING
- 应该说JSON才是那个最popular的序列化方式，在遇到性能瓶颈之前，可以优先考虑json序列化，特别我之前不是写java的，总感觉用一些java特有的序列化协议会导致一些问题，首要的就是序列化内容基本没有可读性，然后就是其他语言基本上没法接入。